<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8" />
        
        <title></title>        
    </head>    
    <body>
    </body>
        
    <script type="module">
        import DaMonster from './dist/core/damonster.js';
        
        
        import DaPlayer from './dist/component/daplayer.js';
        
        import Observable from './dist/utility/observable.js';
        
        //var map = []; 
        var daMonster = window.daMonster = new DaMonster();        
                
        //data binding to component...
        //swap whatever variable we needed to proxy so that we can do the binding....
                                                        
        daMonster.players.forEach((p, index) =>{
        
            let daPlayerComponent = new DaPlayer();
            
                
            Observable.addListener(p, 'hand', (newValue)=>{
                let cards = '';
                p.hand.forEach((c, index) =>{
                    cards += ( '[' + index + '-' + c.tostring() + '], ');
                });
                daPlayerComponent.setAttribute('data-hand', cards);
                //console.log(p.name + ' ' + newValue);
            });
            
            Observable.addListener(p, 'monsterKilled', (newValue)=>{
                 let cards = '';
                p.monsterKilled.forEach((c, index) =>{
                    cards += ( '[' + index + '-' + c.tostring() + '], ');
                });
                daPlayerComponent.setAttribute('data-monster-killed', cards);            
            });       
            
            Observable.addListener(p, 'hero', (newValue)=>{                                                                         
                if (newValue){
                    daPlayerComponent.setAttribute('data-hero', newValue.tostring());
                                                     
                    //remove existing listener and hook to new hero.item??                    
                    
                    //hook to new hero.item                
                    Observable.addListener(newValue, 'items', (newValue) =>{
                        let items = '';
                        p.hero.items.forEach((i, index) =>{
                            items += ( '[' + index + '-' + i.tostring() + '], ');
                        });
                        daPlayerComponent.setAttribute('data-hero-items', items);
                        daPlayerComponent.setAttribute('data-point', p.hero.totalPoint);                    
                    });
                    
                    daPlayerComponent.setAttribute('data-point', newValue.totalPoint);
                }else{
                    daPlayerComponent.setAttribute('data-hero', 'None');
                    daPlayerComponent.setAttribute('data-hero-items', 'None');
                    daPlayerComponent.setAttribute('data-point', 0);
                }    
                
                                                            
                           
            });
                                      
                             
            document.body.appendChild(daPlayerComponent);
                                 
        });
        
        daMonster.New();

    </script>

</html>